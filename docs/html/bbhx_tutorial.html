<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>bbhx Tutorial &mdash; bbhx  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/nbsphinx-code-cells.css?v=2aa19091" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Utility Functions" href="user/utils.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: coral" >

          
          
          <a href="index.html" class="icon icon-home">
            bbhx
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="user/main.html">Full TDI Waveforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="user/waveforms.html">Available Waveform Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="user/response.html">LISA Response Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="user/like.html">Likelihood Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="user/utils.html">Utility Functions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorial:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#"><code class="docutils literal notranslate"><span class="pre">bbhx</span></code> Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="#GPU-accelerated-MBHB-waveforms-for-LISA">GPU accelerated MBHB waveforms for LISA</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Adjust-inspiral-timing">Adjust inspiral timing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Controlling-interpolation">Controlling interpolation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Check-number-of-points-that-is-good-for-interpolation:">Check number of points that is good for interpolation:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Generate-waveforms-without-interpolation">Generate waveforms without interpolation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Adjusting-mode-content">Adjusting mode content</a></li>
<li class="toctree-l2"><a class="reference internal" href="#All-of-these-functions-can-take-arrays-for-parameters">All of these functions can take arrays for parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#The-fill-keyword-argument">The <code class="docutils literal notranslate"><span class="pre">fill</span></code> keyword argument</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Generating-PhenomHM-waveforms">Generating PhenomHM waveforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="#Fast-FD-Response">Fast FD Response</a></li>
<li class="toctree-l1"><a class="reference internal" href="#Computing-the-Likelihood">Computing the Likelihood</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Computing-the-log-Likelihood-for-MBHBs-directly-against-the-Fourier-transform-of-data">Computing the log-Likelihood for MBHBs directly against the Fourier transform of data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Heterodyned-Likelihoods">Heterodyned Likelihoods</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Utility-functions">Utility functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Transformation-functions">Transformation functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Transformations-to-and-from-LISA-and-SSB-reference-frames">Transformations to and from LISA and SSB reference frames</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Posterior-sky-mode-transformation">Posterior sky-mode transformation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#Citations">Citations</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: coral" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">bbhx</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><code class="docutils literal notranslate"><span class="pre">bbhx</span></code> Tutorial</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/bbhx_tutorial.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="user/utils.html" class="btn btn-neutral float-left" title="Utility Functions" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="bbhx-Tutorial">
<h1><code class="docutils literal notranslate"><span class="pre">bbhx</span></code> Tutorial<a class="headerlink" href="#bbhx-Tutorial" title="Link to this heading"></a></h1>
<p><code class="docutils literal notranslate"><span class="pre">bbhx</span></code> is a software package that produces black hole binary waveforms. It focuses on LISA and provides the proper LISA response function for MBHBs (<a class="reference external" href="https://arxiv.org/abs/1806.10734">arXiv:1806.10734</a>, <a class="reference external" href="https://arxiv.org/abs/2003.00357">arXiv:2003.00357</a>). <code class="docutils literal notranslate"><span class="pre">bbhx</span></code> also provides fast likelihood functions. The package is GPU-accelerated for fast analysis.</p>
<p>If you use this software please cite <a class="reference external" href="https://arxiv.org/abs/2005.01827">arXiv:2005.01827</a>, <a class="reference external" href="https://arxiv.org/abs/2111.01064">arXiv:2111.01064</a>, and the associated <a class="reference external" href="https://zenodo.org/record/5730688#.YaFvRkJKhTY">Zenodo page</a> Please also cite any consituent parts used like the response function or waveforms. See the <code class="docutils literal notranslate"><span class="pre">citation</span></code> attribute for each class or docstring for functions for more information.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">from</span> <span class="nn">bbhx.waveformbuild</span> <span class="kn">import</span> <span class="n">BBHWaveformFD</span>
<span class="kn">from</span> <span class="nn">bbhx.waveforms.phenomhm</span> <span class="kn">import</span> <span class="n">PhenomHMAmpPhase</span>
<span class="kn">from</span> <span class="nn">bbhx.response.fastfdresponse</span> <span class="kn">import</span> <span class="n">LISATDIResponse</span>
<span class="kn">from</span> <span class="nn">bbhx.likelihood</span> <span class="kn">import</span> <span class="n">Likelihood</span><span class="p">,</span> <span class="n">HeterodynedLikelihood</span>
<span class="kn">from</span> <span class="nn">bbhx.utils.constants</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">bbhx.utils.transform</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">from</span> <span class="nn">lisatools.sensitivity</span> <span class="kn">import</span> <span class="n">get_sensitivity</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">111222</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
No CuPy
No CuPy or GPU PhenomHM module.
No CuPy or GPU interpolation available.
No CuPy or GPU response available.
No CuPy
</pre></div></div>
</div>
</section>
<section id="GPU-accelerated-MBHB-waveforms-for-LISA">
<h1>GPU accelerated MBHB waveforms for LISA<a class="headerlink" href="#GPU-accelerated-MBHB-waveforms-for-LISA" title="Link to this heading"></a></h1>
<p>First, we will detail how to produce full waveforms for MBHBs to be detected by LISA. We will look at how to generate PhenomHM waveforms (<a class="reference external" href="https://arxiv.org/abs/1708.00404">arXiv:1708.00404</a>, <a class="reference external" href="https://arxiv.org/abs/1508.07253">arXiv:1508.07253</a>, <a class="reference external" href="https://arxiv.org/abs/1508.07250">arXiv:1508.07250</a>) put through the LISA response function ((<a class="reference external" href="https://arxiv.org/abs/1806.10734">arXiv:1806.10734</a>, <a class="reference external" href="https://arxiv.org/abs/2003.00357">arXiv:2003.00357</a>). More information on generating the
waveforms and response separately can be found below.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wave_gen</span> <span class="o">=</span> <span class="n">BBHWaveformFD</span><span class="p">(</span><span class="n">amp_phase_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">run_phenomd</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set parameters</span>
<span class="n">f_ref</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># let phenom codes set f_ref -&gt; fmax = max(f^2A(f))</span>
<span class="n">phi_ref</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="c1"># phase at f_ref</span>
<span class="n">m1</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">m2</span> <span class="o">=</span> <span class="mf">5e5</span>
<span class="n">a1</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">a2</span> <span class="o">=</span> <span class="mf">0.4</span>
<span class="n">dist</span> <span class="o">=</span> <span class="mf">18e3</span>  <span class="o">*</span> <span class="n">PC_SI</span> <span class="o">*</span> <span class="mf">1e6</span> <span class="c1"># 3e3 in Mpc</span>
<span class="n">inc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">3.</span>
<span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">4.</span>  <span class="c1"># ecliptic latitude</span>
<span class="n">lam</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">5.</span>  <span class="c1"># ecliptic longitude</span>
<span class="n">psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">6.</span>  <span class="c1"># polarization angle</span>
<span class="n">t_ref</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">YRSID_SI</span>  <span class="c1"># t_ref  (in the SSB reference frame)</span>

<span class="c1"># frequencies to interpolate to</span>
<span class="n">freq_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
<span class="n">modes</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">)]</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wave</span> <span class="o">=</span> <span class="n">wave_gen</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span>
                          <span class="n">dist</span><span class="p">,</span> <span class="n">phi_ref</span><span class="p">,</span> <span class="n">f_ref</span><span class="p">,</span> <span class="n">inc</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span>
                          <span class="n">beta</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">t_ref</span><span class="p">,</span> <span class="n">freqs</span><span class="o">=</span><span class="n">freq_new</span><span class="p">,</span>
                          <span class="n">modes</span><span class="o">=</span><span class="n">modes</span><span class="p">,</span> <span class="n">direct</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">1024</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">let</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">]):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">freq_new</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">wave</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">label</span><span class="o">=</span><span class="n">let</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\tilde</span><span class="si">{h}</span><span class="s2">(f)$ (Hz$^{-1/2}$)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;$\\tilde{h}(f)$ (Hz$^{-1/2}$)&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/bbhx_tutorial_7_1.png" src="_images/bbhx_tutorial_7_1.png" />
</div>
</div>
<section id="Adjust-inspiral-timing">
<h2>Adjust inspiral timing<a class="headerlink" href="#Adjust-inspiral-timing" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># start at the beginning of observation</span>
<span class="n">t_obs_start</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="n">t_obs_end</span> <span class="o">=</span> <span class="p">(</span><span class="n">t_ref</span> <span class="o">-</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">3600</span><span class="p">)</span> <span class="o">/</span> <span class="n">YRSID_SI</span>  <span class="c1"># 1 day before merger</span>

<span class="n">wave</span> <span class="o">=</span> <span class="n">wave_gen</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span>
                          <span class="n">dist</span><span class="p">,</span> <span class="n">phi_ref</span><span class="p">,</span> <span class="n">f_ref</span><span class="p">,</span> <span class="n">inc</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span>
                          <span class="n">beta</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">t_ref</span><span class="p">,</span> <span class="n">freqs</span><span class="o">=</span><span class="n">freq_new</span><span class="p">,</span>
                          <span class="n">modes</span><span class="o">=</span><span class="n">modes</span><span class="p">,</span> <span class="n">direct</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">t_obs_start</span><span class="o">=</span><span class="n">t_obs_start</span><span class="p">,</span> <span class="n">t_obs_end</span><span class="o">=</span><span class="n">t_obs_end</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">let</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">]):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">freq_new</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">wave</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">label</span><span class="o">=</span><span class="n">let</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\tilde</span><span class="si">{h}</span><span class="s2">(f)$ (Hz$^{-1/2}$)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;$\\tilde{h}(f)$ (Hz$^{-1/2}$)&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/bbhx_tutorial_9_1.png" src="_images/bbhx_tutorial_9_1.png" />
</div>
</div>
</section>
<section id="Controlling-interpolation">
<h2>Controlling interpolation<a class="headerlink" href="#Controlling-interpolation" title="Link to this heading"></a></h2>
<p>The user has the option to control the interpolation by providing the number of frequencies to interpolate over with the <code class="docutils literal notranslate"><span class="pre">length</span></code> keyword argument.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># number of points is too small</span>
<span class="n">length</span> <span class="o">=</span> <span class="mi">128</span>

<span class="n">wave1</span> <span class="o">=</span> <span class="n">wave_gen</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span>
                          <span class="n">dist</span><span class="p">,</span> <span class="n">phi_ref</span><span class="p">,</span> <span class="n">f_ref</span><span class="p">,</span> <span class="n">inc</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span>
                          <span class="n">beta</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">t_ref</span><span class="p">,</span> <span class="n">freqs</span><span class="o">=</span><span class="n">freq_new</span><span class="p">,</span>
                          <span class="n">modes</span><span class="o">=</span><span class="n">modes</span><span class="p">,</span> <span class="n">direct</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="n">length</span><span class="p">,</span>
                <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># high number of points is good</span>
<span class="n">length</span> <span class="o">=</span> <span class="mi">16384</span>

<span class="n">wave2</span> <span class="o">=</span> <span class="n">wave_gen</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span>
                          <span class="n">dist</span><span class="p">,</span> <span class="n">phi_ref</span><span class="p">,</span> <span class="n">f_ref</span><span class="p">,</span> <span class="n">inc</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span>
                          <span class="n">beta</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">t_ref</span><span class="p">,</span> <span class="n">freqs</span><span class="o">=</span><span class="n">freq_new</span><span class="p">,</span>
                          <span class="n">modes</span><span class="o">=</span><span class="n">modes</span><span class="p">,</span> <span class="n">direct</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="n">length</span><span class="p">,</span>
                <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">let</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">]):</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">freq_new</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">wave1</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">label</span><span class="o">=</span><span class="n">let</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">freq_new</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">wave2</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">label</span><span class="o">=</span><span class="n">let</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\tilde</span><span class="si">{h}</span><span class="s2">(f)$ (Hz$^{-1/2}$)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 0, &#39;Frequency (Hz)&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/bbhx_tutorial_12_1.png" src="_images/bbhx_tutorial_12_1.png" />
</div>
</div>
<section id="Check-number-of-points-that-is-good-for-interpolation:">
<h3>Check number of points that is good for interpolation:<a class="headerlink" href="#Check-number-of-points-that-is-good-for-interpolation:" title="Link to this heading"></a></h3>
<p>Generally, most reasonable numbers of points are fine for interpolation. We usually put 1024 to be conservative. It can slightly affect the waveform timing.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># compute directly first (see below)</span>
<span class="n">wave</span> <span class="o">=</span> <span class="n">wave_gen</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span>
                          <span class="n">dist</span><span class="p">,</span> <span class="n">phi_ref</span><span class="p">,</span> <span class="n">f_ref</span><span class="p">,</span> <span class="n">inc</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span>
                          <span class="n">beta</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">t_ref</span><span class="p">,</span> <span class="n">freqs</span><span class="o">=</span><span class="n">freq_new</span><span class="p">,</span>
                          <span class="n">modes</span><span class="o">=</span><span class="n">modes</span><span class="p">,</span> <span class="n">direct</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">)</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">lengths_in</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">mismatch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">lengths_in</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">length</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lengths_in</span><span class="p">):</span>
   <span class="c1"># compute directly first (see below)</span>
    <span class="n">wave_temp</span> <span class="o">=</span> <span class="n">wave_gen</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span>
                              <span class="n">dist</span><span class="p">,</span> <span class="n">phi_ref</span><span class="p">,</span> <span class="n">f_ref</span><span class="p">,</span> <span class="n">inc</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span>
                              <span class="n">beta</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">t_ref</span><span class="p">,</span> <span class="n">freqs</span><span class="o">=</span><span class="n">freq_new</span><span class="p">,</span>
                              <span class="n">modes</span><span class="o">=</span><span class="n">modes</span><span class="p">,</span>
                              <span class="n">direct</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="n">length</span>
                    <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">wave_temp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">conj</span><span class="p">(),</span> <span class="n">wave</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)])</span>
    <span class="n">den1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">wave</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">conj</span><span class="p">(),</span> <span class="n">wave</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)])</span>
    <span class="n">den2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">wave_temp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">conj</span><span class="p">(),</span> <span class="n">wave_temp</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)])</span>
    <span class="n">overlap</span> <span class="o">=</span> <span class="n">num</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">den1</span> <span class="o">*</span> <span class="n">den2</span><span class="p">)</span>
    <span class="n">mismatch</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">overlap</span><span class="o">.</span><span class="n">real</span>

<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">lengths_in</span><span class="p">,</span> <span class="n">mismatch</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Number of initial frequencies&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Mismatch&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;Mismatch&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/bbhx_tutorial_15_1.png" src="_images/bbhx_tutorial_15_1.png" />
</div>
</div>
</section>
</section>
<section id="Generate-waveforms-without-interpolation">
<h2>Generate waveforms without interpolation<a class="headerlink" href="#Generate-waveforms-without-interpolation" title="Link to this heading"></a></h2>
<p>When interpolating, frequencies between <span class="math notranslate nohighlight">\(10^{-4}/M\)</span> and <span class="math notranslate nohighlight">\(0.6/M\)</span> are evaluated. Therefore, when not interpolating, the evaluation of the waveform will stretch outside these limits if frequencies outside those limits are given by the user.</p>
<p>With <code class="docutils literal notranslate"><span class="pre">compress=True</span></code>, all modes will be directly combined.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wave</span> <span class="o">=</span> <span class="n">wave_gen</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span>
                          <span class="n">dist</span><span class="p">,</span> <span class="n">phi_ref</span><span class="p">,</span> <span class="n">f_ref</span><span class="p">,</span> <span class="n">inc</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span>
                          <span class="n">beta</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">t_ref</span><span class="p">,</span> <span class="n">freqs</span><span class="o">=</span><span class="n">freq_new</span><span class="p">,</span>
                          <span class="n">modes</span><span class="o">=</span><span class="n">modes</span><span class="p">,</span> <span class="n">direct</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">let</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">]):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">freq_new</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">wave</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">label</span><span class="o">=</span><span class="n">let</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\tilde</span><span class="si">{h}</span><span class="s2">(f)$ (Hz$^{-1/2}$)&quot;</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;$\\tilde{h}(f)$ (Hz$^{-1/2}$)&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/bbhx_tutorial_18_1.png" src="_images/bbhx_tutorial_18_1.png" />
</div>
</div>
<p>With <code class="docutils literal notranslate"><span class="pre">compress=False</span></code>, it will keep the modes separate.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wave</span> <span class="o">=</span> <span class="n">wave_gen</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span>
                          <span class="n">dist</span><span class="p">,</span> <span class="n">phi_ref</span><span class="p">,</span> <span class="n">f_ref</span><span class="p">,</span> <span class="n">inc</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span>
                          <span class="n">beta</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">t_ref</span><span class="p">,</span> <span class="n">freqs</span><span class="o">=</span><span class="n">freq_new</span><span class="p">,</span>
                          <span class="n">modes</span><span class="o">=</span><span class="n">modes</span><span class="p">,</span> <span class="n">direct</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mode</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">wave_gen</span><span class="o">.</span><span class="n">amp_phase_gen</span><span class="o">.</span><span class="n">modes</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">freq_new</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">wave</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]),</span> <span class="n">label</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\tilde</span><span class="si">{h}</span><span class="s2">(f)$ (Hz$^{-1/2}$)&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1e-1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">1e-27</span><span class="p">,</span> <span class="mf">1e-14</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(1e-27, 1e-14)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/bbhx_tutorial_20_1.png" src="_images/bbhx_tutorial_20_1.png" />
</div>
</div>
</section>
<section id="Adjusting-mode-content">
<h2>Adjusting mode content<a class="headerlink" href="#Adjusting-mode-content" title="Link to this heading"></a></h2>
<p>You can adjust the mode content with the <code class="docutils literal notranslate"><span class="pre">modes</span></code> keyword argument. You will receive an error if the requested mode indices <span class="math notranslate nohighlight">\((l,m)\)</span> are not available for the given waveform model chosen.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wave</span> <span class="o">=</span> <span class="n">wave_gen</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span>
                          <span class="n">dist</span><span class="p">,</span> <span class="n">phi_ref</span><span class="p">,</span> <span class="n">f_ref</span><span class="p">,</span> <span class="n">inc</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span>
                          <span class="n">beta</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">t_ref</span><span class="p">,</span> <span class="n">freqs</span><span class="o">=</span><span class="n">freq_new</span><span class="p">,</span>
                          <span class="n">modes</span><span class="o">=</span><span class="p">[(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">)],</span> <span class="n">direct</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mode</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">wave_gen</span><span class="o">.</span><span class="n">amp_phase_gen</span><span class="o">.</span><span class="n">modes</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">freq_new</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">wave</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]),</span> <span class="n">label</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\tilde</span><span class="si">{h}</span><span class="s2">(f)$ (Hz$^{-1/2}$)&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1e-1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">1e-27</span><span class="p">,</span> <span class="mf">1e-14</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(1e-27, 1e-14)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/bbhx_tutorial_23_1.png" src="_images/bbhx_tutorial_23_1.png" />
</div>
</div>
</section>
<section id="All-of-these-functions-can-take-arrays-for-parameters">
<h2>All of these functions can take arrays for parameters<a class="headerlink" href="#All-of-these-functions-can-take-arrays-for-parameters" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set parameters</span>
<span class="n">f_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>  <span class="c1"># let phenom codes set fRef -&gt; fmax = max(f^2A(f))</span>
<span class="n">phi_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
<span class="n">m1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1e6</span><span class="p">,</span> <span class="mf">4e5</span><span class="p">])</span>
<span class="n">m2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">5e5</span><span class="p">,</span> <span class="mf">1e5</span><span class="p">])</span>
<span class="n">a1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span>
<span class="n">a2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">])</span>
<span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">10e3</span><span class="p">,</span> <span class="mf">1e3</span><span class="p">])</span>  <span class="o">*</span> <span class="n">PC_SI</span> <span class="o">*</span> <span class="mf">1e6</span> <span class="c1"># 3e3 in Mpc</span>
<span class="n">inc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">])</span>
<span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">5</span><span class="p">])</span>
<span class="n">lam</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">5.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">6</span><span class="p">])</span>
<span class="n">psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">6.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">7</span><span class="p">])</span>
<span class="n">t_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">])</span> <span class="o">*</span> <span class="n">YRSID_SI</span>  <span class="c1"># in the SSB reference frame</span>

<span class="c1"># frequencies to interpolate to</span>
<span class="n">freq_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
<span class="n">modes</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">)]</span>

<span class="n">waves</span> <span class="o">=</span> <span class="n">wave_gen</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span>
                  <span class="n">dist</span><span class="p">,</span> <span class="n">phi_ref</span><span class="p">,</span> <span class="n">f_ref</span><span class="p">,</span> <span class="n">inc</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span>
                  <span class="n">beta</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">t_ref</span><span class="p">,</span> <span class="n">freqs</span><span class="o">=</span><span class="n">freq_new</span><span class="p">,</span>
                  <span class="n">modes</span><span class="o">=</span><span class="n">modes</span><span class="p">,</span> <span class="n">direct</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span>

<span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">ls</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span> <span class="s2">&quot;dashed&quot;</span><span class="p">]):</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">let</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">]):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">freq_new</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">waves</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]),</span> <span class="n">label</span><span class="o">=</span><span class="n">let</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; bin </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\tilde</span><span class="si">{h}</span><span class="s2">(f)$ (Hz$^{-1/2}$)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;$\\tilde{h}(f)$ (Hz$^{-1/2}$)&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/bbhx_tutorial_25_1.png" src="_images/bbhx_tutorial_25_1.png" />
</div>
</div>
</section>
<section id="The-fill-keyword-argument">
<h2>The <code class="docutils literal notranslate"><span class="pre">fill</span></code> keyword argument<a class="headerlink" href="#The-fill-keyword-argument" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">fill</span></code> keyword argument allows the user to fill the data stream as in the first example above. However, it can give two other returns. (It is only available when <code class="docutils literal notranslate"><span class="pre">direct=False</span></code>.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">fill=False</span></code>, it will return special information used in the fast likelihood function. This includes templates as shortened arrays (only the values where <span class="math notranslate nohighlight">\(\tilde{h}(f)\)</span> is non-zero), the information on which frequency each array starts at and its length.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">templates</span><span class="p">,</span> <span class="n">start_inds</span><span class="p">,</span> <span class="n">lengths</span> <span class="o">=</span> <span class="n">wave_gen</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span>
                          <span class="n">dist</span><span class="p">,</span> <span class="n">phi_ref</span><span class="p">,</span> <span class="n">f_ref</span><span class="p">,</span> <span class="n">inc</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span>
                          <span class="n">beta</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">t_ref</span><span class="p">,</span> <span class="n">freqs</span><span class="o">=</span><span class="n">freq_new</span><span class="p">,</span>
                          <span class="n">modes</span><span class="o">=</span><span class="n">modes</span><span class="p">,</span> <span class="n">direct</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">templates</span><span class="p">,</span> <span class="n">start_inds</span><span class="p">,</span> <span class="n">lengths</span><span class="p">)</span>

<span class="c1"># plot the first binary</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">let</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">]):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">freq_new</span><span class="p">[</span><span class="n">start_inds</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">start_inds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">templates</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]),</span> <span class="n">label</span><span class="o">=</span><span class="n">let</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\tilde</span><span class="si">{h}</span><span class="s2">(f)$ (Hz$^{-1/2}$)&quot;</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[array([[-3.14154099e-19+2.93930145e-19j, -4.11910745e-19-2.31073392e-19j,
         7.18639789e-20-4.30372868e-19j, ...,
        -1.21330575e-43-4.29769485e-44j,  6.36570618e-46-1.07049893e-43j,
        -1.51012483e-45-8.87380319e-44j],
       [-3.77142996e-19+6.09479474e-19j, -7.23835376e-19-1.45368093e-19j,
        -9.26662932e-20-7.14586769e-19j, ...,
         2.57629108e-43-8.19014428e-44j,  1.33780103e-43+1.81800785e-43j,
         1.11242618e-43+1.49366094e-43j],
       [-2.82108635e-28+4.25544336e-28j, -5.89161226e-28+6.21183363e-30j,
        -9.93313342e-29-5.74008671e-28j, ...,
        -3.89107774e-44-4.92386953e-44j,  2.82041850e-44-4.37426151e-44j,
         2.24209609e-44-3.62845654e-44j]]), array([[-3.07245461e-20+6.26998385e-21j,  2.18054463e-20-2.25976697e-20j,
        -4.29271950e-21+3.11543715e-20j, ...,
        -2.78259785e-20-8.22146447e-20j,  7.77498602e-20+3.89050092e-20j,
        -7.88818912e-20+3.68982312e-20j],
       [ 1.30420115e-20+4.61283100e-22j, -1.09311648e-20+7.26757282e-21j,
         4.32441893e-21-1.24795359e-20j, ...,
         9.23185723e-20+2.51389976e-20j, -8.34510053e-20+4.74818772e-20j,
         1.43365804e-20-9.52734595e-20j],
       [ 3.26882976e-30+8.96343560e-29j, -5.51509029e-29-7.21135974e-29j,
         8.84898291e-29+2.47851396e-29j, ...,
        -2.76775148e-26+4.58288676e-26j, -1.27450933e-26-5.22741814e-26j,
         4.91910732e-26+2.24536166e-26j]])] [0 0] [8026 1681]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;$\\tilde{h}(f)$ (Hz$^{-1/2}$)&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/bbhx_tutorial_28_2.png" src="_images/bbhx_tutorial_28_2.png" />
</div>
</div>
<p>The binaries can also be combined into one data stream with <code class="docutils literal notranslate"><span class="pre">fill=True</span></code> and <code class="docutils literal notranslate"><span class="pre">combine=True</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">waves</span> <span class="o">=</span> <span class="n">wave_gen</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span>
                  <span class="n">dist</span><span class="p">,</span> <span class="n">phi_ref</span><span class="p">,</span> <span class="n">f_ref</span><span class="p">,</span> <span class="n">inc</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span>
                  <span class="n">beta</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">t_ref</span><span class="p">,</span> <span class="n">freqs</span><span class="o">=</span><span class="n">freq_new</span><span class="p">,</span>
                  <span class="n">modes</span><span class="o">=</span><span class="n">modes</span><span class="p">,</span> <span class="n">direct</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">combine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">let</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">]):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">freq_new</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">waves</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">label</span><span class="o">=</span><span class="n">let</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\tilde</span><span class="si">{h}</span><span class="s2">(f)$ (Hz$^{-1/2}$)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;$\\tilde{h}(f)$ (Hz$^{-1/2}$)&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/bbhx_tutorial_30_1.png" src="_images/bbhx_tutorial_30_1.png" />
</div>
</div>
</section>
</section>
<section id="Generating-PhenomHM-waveforms">
<h1>Generating PhenomHM waveforms<a class="headerlink" href="#Generating-PhenomHM-waveforms" title="Link to this heading"></a></h1>
<p>Now we will create PhenomHM waveforms in the source frame, but scaled for the distance.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">phenomhm</span> <span class="o">=</span> <span class="n">PhenomHMAmpPhase</span><span class="p">(</span><span class="n">use_gpu</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">run_phenomd</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f_ref</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># let phenom codes set f_ref -&gt; fmax = max(f^2A(f))</span>
<span class="n">phi_ref</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="c1"># phase at f_ref</span>
<span class="n">m1</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">m2</span> <span class="o">=</span> <span class="mf">5e5</span>
<span class="n">a1</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">a2</span> <span class="o">=</span> <span class="mf">0.4</span>
<span class="n">dist</span> <span class="o">=</span> <span class="mf">18e3</span>  <span class="o">*</span> <span class="n">PC_SI</span> <span class="o">*</span> <span class="mf">1e6</span> <span class="c1"># 3e3 in Mpc</span>
<span class="n">t_ref</span> <span class="o">=</span> <span class="mf">0.95</span> <span class="o">*</span> <span class="n">YRSID_SI</span>

<span class="n">modes</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>

<span class="n">phenomhm</span><span class="p">(</span>
    <span class="n">m1</span><span class="p">,</span>
    <span class="n">m2</span><span class="p">,</span>
    <span class="n">a1</span><span class="p">,</span>
    <span class="n">a2</span><span class="p">,</span>
    <span class="n">dist</span><span class="p">,</span>
    <span class="n">phi_ref</span><span class="p">,</span>
    <span class="n">f_ref</span><span class="p">,</span>
    <span class="n">t_ref</span><span class="p">,</span>
    <span class="mi">1024</span><span class="p">,</span>
    <span class="n">modes</span><span class="o">=</span><span class="n">modes</span>
<span class="p">)</span>

<span class="c1"># get important quantities</span>
<span class="n">freqs</span> <span class="o">=</span> <span class="n">phenomhm</span><span class="o">.</span><span class="n">freqs_shaped</span>  <span class="c1"># shape (num_bin_all, num_modes, length)</span>
<span class="n">amps</span> <span class="o">=</span> <span class="n">phenomhm</span><span class="o">.</span><span class="n">amp</span>  <span class="c1"># shape (num_bin_all, num_modes, length)</span>
<span class="n">phase</span> <span class="o">=</span> <span class="n">phenomhm</span><span class="o">.</span><span class="n">phase</span>  <span class="c1"># shape (num_bin_all, num_modes, length)</span>
<span class="n">tf</span> <span class="o">=</span> <span class="n">phenomhm</span><span class="o">.</span><span class="n">tf</span>  <span class="c1"># shape (num_bin_all, num_modes, length)</span>
</pre></div>
</div>
</div>
<p>Plot Amplitudes</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mode</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">modes</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">freqs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">freqs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">amps</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Characteristic Strain&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x13660aa20&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/bbhx_tutorial_36_1.png" src="_images/bbhx_tutorial_36_1.png" />
</div>
</div>
</section>
<section id="Fast-FD-Response">
<h1>Fast FD Response<a class="headerlink" href="#Fast-FD-Response" title="Link to this heading"></a></h1>
<p>A large amount of the Fast FD Response codes were provided by Sylvain Marsat, so thank you to him! Detailed information on the response can be found in <a class="reference external" href="https://arxiv.org/abs/1806.10734">arXiv:1806.10734</a> and <a class="reference external" href="https://arxiv.org/abs/2003.00357">arXiv:2003.00357</a>. The response works by applying an effective transfer function, <span class="math notranslate nohighlight">\(\mathcal{T}(f, t(f))\)</span>, to the waveform to get the TDI channels:</p>
<div class="math notranslate nohighlight">
\[\tilde{h}^{AET}(f) = \mathcal{T}(f, t(f))\tilde{h}^\text{SSB}(f),\]</div>
<p>where <span class="math notranslate nohighlight">\(t(f)\)</span> is the time-frequency correspondence. This determines where the LISA constellation is in its orbit. This response function assumes the arms of the constellation are constant in time.</p>
<p>The response function operates directly on information coming from the base waveform generation in PhenomHM when you run <code class="docutils literal notranslate"><span class="pre">BBHWaveformFD</span></code>. To run the response separately you need to provide a phase and tf vector. The phase is adjusted inside the response code. If you do not want that to happen, you can add the keyword argument <code class="docutils literal notranslate"><span class="pre">adjust_phase=False</span></code>. If you are just running the response function to use it itself and not using to adjust phase, you can just put in zeros for the phase, it will not
affect the computation. All parameters for the response are in the SSB frame. This function can take 1D arrays for the parameters as well. In this case, you need <code class="docutils literal notranslate"><span class="pre">freqs.shape=(num_bin_all,</span> <span class="pre">length)</span></code>, <code class="docutils literal notranslate"><span class="pre">phases.shape=tf.shape=(num_bin_all,</span> <span class="pre">num_modes,</span> <span class="pre">length)</span></code> with <code class="docutils literal notranslate"><span class="pre">num_bin_all</span></code> the total number of binaries, <code class="docutils literal notranslate"><span class="pre">num_modes</span></code> the number of harmonics, and <code class="docutils literal notranslate"><span class="pre">length</span></code> number of frequencies to evaluate per binary.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># use phase/tf information from last waveform run</span>
<span class="n">freqs</span> <span class="o">=</span> <span class="n">phenomhm</span><span class="o">.</span><span class="n">freqs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">phase</span> <span class="o">=</span> <span class="n">phenomhm</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">tf</span> <span class="o">=</span> <span class="n">phenomhm</span><span class="o">.</span><span class="n">tf</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">modes</span> <span class="o">=</span> <span class="n">phenomhm</span><span class="o">.</span><span class="n">modes</span>

<span class="n">phi_ref</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">inc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span>
<span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">5</span>
<span class="n">lam</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">6</span>
<span class="n">psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">7</span>

<span class="n">length</span> <span class="o">=</span> <span class="n">phenomhm</span><span class="o">.</span><span class="n">freqs_shaped</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">freqs_shaped</span> <span class="o">=</span> <span class="n">phenomhm</span><span class="o">.</span><span class="n">freqs_shaped</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">LISATDIResponse</span><span class="p">()</span>
<span class="n">response</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span>
        <span class="n">inc</span><span class="p">,</span>
        <span class="n">lam</span><span class="p">,</span>
        <span class="n">beta</span><span class="p">,</span>
        <span class="n">psi</span><span class="p">,</span>
        <span class="n">phi_ref</span><span class="p">,</span>
        <span class="n">length</span><span class="p">,</span>
        <span class="n">phase</span><span class="o">=</span><span class="n">phase</span><span class="p">,</span>
        <span class="n">tf</span><span class="o">=</span><span class="n">tf</span><span class="p">,</span>
        <span class="n">modes</span><span class="o">=</span><span class="n">modes</span><span class="p">)</span>

<span class="c1"># plot parts of the response</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>

    <span class="c1"># (2, 2) mode</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">modes</span><span class="o">.</span><span class="n">index</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="c1"># response.transferL1</span>
    <span class="n">transfer</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;transferL</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">freqs_shaped</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">index</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">transfer</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">index</span><span class="p">]),</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;L</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> Real&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;C</span><span class="si">{</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1">#plt.loglog(freqs, transfer.imag[0, index], label=f&quot;L{i} Imag&quot;, ls=&quot;dashed&quot;, color=f&quot;C{i-1}&quot;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\mathcal</span><span class="si">{T}</span><span class="s2">(f, t(f))$&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;$\\mathcal{T}(f, t(f))$&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/bbhx_tutorial_39_1.png" src="_images/bbhx_tutorial_39_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># use phase/tf information from last waveform run</span>

<span class="n">num_bin_all</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">phenomhm</span><span class="o">.</span><span class="n">freqs_shaped</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="p">(</span><span class="n">num_bin_all</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">phenomhm</span><span class="o">.</span><span class="n">phase</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="p">(</span><span class="n">num_bin_all</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">tf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">phenomhm</span><span class="o">.</span><span class="n">tf</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="p">(</span><span class="n">num_bin_all</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="n">phi_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">num_bin_all</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="n">inc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">num_bin_all</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span>
<span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">num_bin_all</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">5</span><span class="p">)</span>
<span class="n">lam</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">num_bin_all</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span>
<span class="n">psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">num_bin_all</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">7</span><span class="p">)</span>

<span class="n">length</span> <span class="o">=</span> <span class="n">phenomhm</span><span class="o">.</span><span class="n">freqs_shaped</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="n">response</span><span class="p">(</span>
    <span class="n">freqs</span><span class="p">,</span>
    <span class="n">inc</span><span class="p">,</span>
    <span class="n">lam</span><span class="p">,</span>
    <span class="n">beta</span><span class="p">,</span>
    <span class="n">psi</span><span class="p">,</span>
    <span class="n">phi_ref</span><span class="p">,</span>
    <span class="n">length</span><span class="p">,</span>
    <span class="n">phase</span><span class="o">=</span><span class="n">phase</span><span class="p">,</span>
    <span class="n">tf</span><span class="o">=</span><span class="n">tf</span><span class="p">,</span>
    <span class="n">modes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># defaults to phenomhm modes</span>
    <span class="n">adjust_phase</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># if you want to keep the phase array you input the same, set this to false.</span>
<span class="p">)</span>  <span class="c1"># You can get adjusted phases with response.phase</span>
<span class="nb">print</span><span class="p">(</span><span class="n">freqs</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">phase</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">transferL1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># get phase adjustment by response function</span>
<span class="n">phase_diff</span> <span class="o">=</span> <span class="n">phase</span> <span class="o">-</span> <span class="n">phenomhm</span><span class="o">.</span><span class="n">phase</span>

<span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">freqs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">phase_diff</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Phase Difference from Response Function&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(10, 6, 1024) (10, 6, 1024) (10, 6, 1024) (10, 6, 1024)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;Phase Difference from Response Function&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/bbhx_tutorial_40_2.png" src="_images/bbhx_tutorial_40_2.png" />
</div>
</div>
<p>If building a waveform, you can also put a larger buffer object directly into the response code. This larger buffer object would be carrying amplitudes, phases, and tf from the source-frame waveform generator in a flattened 1D array.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">phenomhm</span><span class="o">.</span><span class="n">tf</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2074.3644391335547
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_bin_all</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">length</span> <span class="o">=</span> <span class="mi">1024</span>
<span class="n">num_modes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">modes</span><span class="p">)</span>
<span class="n">buffer_shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="n">num_bin_all</span><span class="p">,</span> <span class="n">num_modes</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>
<span class="n">out_buffer</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">buffer_shape</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="n">f_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">num_bin_all</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>  <span class="c1"># let phenom codes set f_ref -&gt; fmax = max(f^2A(f))</span>
<span class="n">phi_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">num_bin_all</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="c1"># phase at f_ref</span>
<span class="n">t_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">num_bin_all</span><span class="p">,</span> <span class="mf">3e6</span><span class="p">)</span> <span class="c1"># time at f_ref</span>
<span class="n">m1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">num_bin_all</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">)</span>
<span class="n">m2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">num_bin_all</span><span class="p">,</span> <span class="mf">5e5</span><span class="p">)</span>
<span class="n">a1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">num_bin_all</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
<span class="n">a2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">num_bin_all</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span>
<span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">num_bin_all</span><span class="p">,</span> <span class="mf">3e3</span><span class="p">)</span>  <span class="o">*</span> <span class="n">PC_SI</span> <span class="o">*</span> <span class="mf">1e6</span> <span class="c1"># 3e3 in Mpc</span>

<span class="n">inc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">num_bin_all</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span>
<span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">num_bin_all</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">5</span><span class="p">)</span>
<span class="n">lam</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">num_bin_all</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span>
<span class="n">psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">num_bin_all</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">7</span><span class="p">)</span>

<span class="n">phenomhm</span><span class="p">(</span>
    <span class="n">m1</span><span class="p">,</span>
    <span class="n">m2</span><span class="p">,</span>
    <span class="n">a1</span><span class="p">,</span>
    <span class="n">a2</span><span class="p">,</span>
    <span class="n">dist</span><span class="p">,</span>
    <span class="n">phi_ref</span><span class="p">,</span>
    <span class="n">f_ref</span><span class="p">,</span>
    <span class="n">t_ref</span><span class="p">,</span>
    <span class="n">length</span><span class="p">,</span>
    <span class="n">out_buffer</span><span class="o">=</span><span class="n">out_buffer</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">out_buffer</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">buffer_shape</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

<span class="n">response</span><span class="p">(</span>
    <span class="n">freqs</span><span class="p">,</span>
    <span class="n">inc</span><span class="p">,</span>
    <span class="n">lam</span><span class="p">,</span>
    <span class="n">beta</span><span class="p">,</span>
    <span class="n">psi</span><span class="p">,</span>
    <span class="n">phi_ref</span><span class="p">,</span>
    <span class="n">length</span><span class="p">,</span>
    <span class="n">out_buffer</span><span class="o">=</span><span class="n">out_buffer</span><span class="p">,</span>
    <span class="n">modes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># defaults to phenomhm modes</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">out_buffer</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">buffer_shape</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="c1"># these are all numbers at the first frequency for (2,2) mode for</span>
<span class="c1"># amp, phase, tf, transferL1re, transferL1im, transferL2re, transferL2im, transferL3re, transferL3im</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[1.70824294e-13 4.14100197e+03 1.65814682e+01 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00]
[ 1.70824294e-13  4.14087439e+03  1.65814682e+01 -3.09383403e-06
  2.34941055e-06  4.04192751e-06  1.44557752e-06  2.79724168e-16
 -4.52904052e-15]
</pre></div></div>
</div>
</section>
<section id="Computing-the-Likelihood">
<h1>Computing the Likelihood<a class="headerlink" href="#Computing-the-Likelihood" title="Link to this heading"></a></h1>
<p>The gravitational-wave likelihood, <span class="math notranslate nohighlight">\(\mathcal{L}\)</span>, is given by</p>
<div class="math notranslate nohighlight">
\[\log{\mathcal{L}}\propto -\frac{1}{2}\langle d-h|d-h\rangle = -\frac{1}{2}\left( \langle d|d\rangle + \langle h|h\rangle - 2\langle d|h\rangle \right),\]</div>
<p>where <span class="math notranslate nohighlight">\(\langle a|b\rangle\)</span> is the noise-weighted inner product between time-domain strain signals <span class="math notranslate nohighlight">\(a(t)\)</span> and <span class="math notranslate nohighlight">\(b(t)\)</span>. This inner product is given by</p>
<div class="math notranslate nohighlight">
\[\langle a|b\rangle = 4\text{Re}\int_0^\infty\frac{\tilde{a}(f)^*\tilde{b}(f)}{S_n(f)}df,\]</div>
<p>where <span class="math notranslate nohighlight">\(S_n(f)\)</span> is the one-sided Power Spectral Density in the noise.</p>
<section id="Computing-the-log-Likelihood-for-MBHBs-directly-against-the-Fourier-transform-of-data">
<h2>Computing the log-Likelihood for MBHBs directly against the Fourier transform of data<a class="headerlink" href="#Computing-the-log-Likelihood-for-MBHBs-directly-against-the-Fourier-transform-of-data" title="Link to this heading"></a></h2>
<p>One option in <code class="docutils literal notranslate"><span class="pre">bbhx</span></code> for computing the likelihood is a direct Likeihood computation: <code class="docutils literal notranslate"><span class="pre">bbhx.likelihood.Likelihood</span></code>. You will need <code class="docutils literal notranslate"><span class="pre">lisatools</span></code> if you want to compute the sensitivity curves. Otherwise, put in your own sensitivity functions or np.ones to get it to work.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">######## generate data</span>
<span class="c1"># set parameters</span>
<span class="n">f_ref</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># let phenom codes set f_ref -&gt; fmax = max(f^2A(f))</span>
<span class="n">phi_ref</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="c1"># phase at f_ref</span>
<span class="n">m1</span> <span class="o">=</span> <span class="mf">1e6</span>
<span class="n">m2</span> <span class="o">=</span> <span class="mf">5e5</span>
<span class="n">a1</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">a2</span> <span class="o">=</span> <span class="mf">0.4</span>
<span class="n">dist</span> <span class="o">=</span> <span class="mf">18e3</span>  <span class="o">*</span> <span class="n">PC_SI</span> <span class="o">*</span> <span class="mf">1e6</span> <span class="c1"># 3e3 in Mpc</span>
<span class="n">inc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">3.</span>
<span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">4.</span>  <span class="c1"># ecliptic latitude</span>
<span class="n">lam</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">5.</span>  <span class="c1"># ecliptic longitude</span>
<span class="n">psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">6.</span>  <span class="c1"># polarization angle</span>
<span class="n">t_ref</span> <span class="o">=</span> <span class="mf">0.9</span> <span class="o">*</span> <span class="n">YRSID_SI</span>  <span class="c1"># t_ref  (in the SSB reference frame)</span>

<span class="n">T_obs</span> <span class="o">=</span> <span class="mf">1.2</span> <span class="c1"># years</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">10.0</span>

<span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">T_obs</span> <span class="o">*</span> <span class="n">YRSID_SI</span> <span class="o">/</span> <span class="n">dt</span><span class="p">)</span>
<span class="n">data_freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfftfreq</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span> <span class="c1"># remove DC</span>

<span class="c1"># frequencies to interpolate to</span>
<span class="n">modes</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">)]</span>
<span class="n">waveform_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">modes</span><span class="o">=</span><span class="n">modes</span><span class="p">,</span> <span class="n">direct</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span>

<span class="n">data_channels</span> <span class="o">=</span> <span class="n">wave_gen</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span>
                          <span class="n">dist</span><span class="p">,</span> <span class="n">phi_ref</span><span class="p">,</span> <span class="n">f_ref</span><span class="p">,</span> <span class="n">inc</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span>
                          <span class="n">beta</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">t_ref</span><span class="p">,</span> <span class="n">freqs</span><span class="o">=</span><span class="n">data_freqs</span><span class="p">,</span>
                          <span class="o">**</span><span class="n">waveform_kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1">######## get noise information (need lisatools)</span>
<span class="n">PSD_A</span> <span class="o">=</span> <span class="n">get_sensitivity</span><span class="p">(</span><span class="n">data_freqs</span><span class="p">,</span> <span class="n">sens_fn</span><span class="o">=</span><span class="s2">&quot;A1TDISens&quot;</span><span class="p">)</span>
<span class="n">PSD_E</span> <span class="o">=</span> <span class="n">get_sensitivity</span><span class="p">(</span><span class="n">data_freqs</span><span class="p">,</span> <span class="n">sens_fn</span><span class="o">=</span><span class="s2">&quot;E1TDISens&quot;</span><span class="p">)</span>
<span class="n">PSD_T</span> <span class="o">=</span> <span class="n">get_sensitivity</span><span class="p">(</span><span class="n">data_freqs</span><span class="p">,</span> <span class="n">sens_fn</span><span class="o">=</span><span class="s2">&quot;T1TDISens&quot;</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">data_freqs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_freqs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">psd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">PSD_A</span><span class="p">,</span> <span class="n">PSD_E</span><span class="p">,</span> <span class="n">PSD_T</span><span class="p">])</span>

<span class="c1"># initialize Likelihood</span>
<span class="n">like</span> <span class="o">=</span> <span class="n">Likelihood</span><span class="p">(</span>
    <span class="n">wave_gen</span><span class="p">,</span>
    <span class="n">data_freqs</span><span class="p">,</span>
    <span class="n">data_channels</span><span class="p">,</span>
    <span class="n">psd</span><span class="p">,</span>
    <span class="n">use_gpu</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># get params</span>
<span class="n">num_bins</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">params_in</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">phi_ref</span><span class="p">,</span> <span class="n">f_ref</span><span class="p">,</span> <span class="n">inc</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">t_ref</span><span class="p">]),</span> <span class="p">(</span><span class="n">num_bins</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="c1"># change masses for test</span>
<span class="n">params_in</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">1e-4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">num_bins</span><span class="p">))</span>

<span class="c1"># get_ll and not __call__ to work with lisatools</span>
<span class="n">ll</span> <span class="o">=</span> <span class="n">like</span><span class="o">.</span><span class="n">get_ll</span><span class="p">(</span><span class="n">params_in</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="o">**</span><span class="n">waveform_kwargs</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">ll</span><span class="p">,</span> <span class="n">like</span><span class="o">.</span><span class="n">d_h</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[ -1.07304677  -9.67441448  -0.82049942  -6.35227414 -10.27292833
  -0.18575894  -0.35926129  -2.60369419  -1.14904283  -5.69420711] [764982.31202969 -591.06049369j 764946.22578225-1778.38208222j
 765008.20318771 +516.83052761j 764957.38520581-1439.90214805j
 764944.36630292-1832.8289125j  764991.18762188 -245.87126849j
 765004.61719784 +341.9503657j  764973.14459642 -921.03288148j
 765010.06945941 +611.6637902j  764959.82211007-1363.06563164j]
</pre></div></div>
</div>
<p>You can also phase marginalize. This occurs in the <span class="math notranslate nohighlight">\(\langle d|h \rangle\)</span> term in the Likelihood.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get_ll and not __call__ to work with lisatools</span>
<span class="n">ll_marg</span> <span class="o">=</span> <span class="n">like</span><span class="o">.</span><span class="n">get_ll</span><span class="p">(</span><span class="n">params_in</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">phase_marginalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">waveform_kwargs</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ll</span><span class="p">,</span> <span class="n">ll_marg</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[[ -1.07304677  -0.84470656]
 [ -9.67441448  -7.60718515]
 [ -0.82049942  -0.64591713]
 [ -6.35227414  -4.99708991]
 [-10.27292833  -8.07717584]
 [ -0.18575894  -0.14624693]
 [ -0.35926129  -0.28283688]
 [ -2.60369419  -2.04922946]
 [ -1.14904283  -0.90451498]
 [ -5.69420711  -4.47979925]]
</pre></div></div>
</div>
<p>You can also return the signal-to-noise ratio: <span class="math notranslate nohighlight">\(\langle d|h \rangle / \sqrt{\langle h|h \rangle}\)</span>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get_ll and not __call__ to work with lisatools</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">like</span><span class="o">.</span><span class="n">get_ll</span><span class="p">(</span><span class="n">params_in</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">return_extracted_snr</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">waveform_kwargs</span><span class="p">)</span>

<span class="c1"># first column is log-Likelihood, second is snr</span>
<span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[[-1.07304677e+00  8.74639879e+02]
 [-9.67441448e+00  8.74630045e+02]
 [-8.20499422e-01  8.74640167e+02]
 [-6.35227414e+00  8.74633843e+02]
 [-1.02729283e+01  8.74629361e+02]
 [-1.85758940e-01  8.74640893e+02]
 [-3.59261290e-01  8.74640695e+02]
 [-2.60369419e+00  8.74638129e+02]
 [-1.14904283e+00  8.74639792e+02]
 [-5.69420711e+00  8.74634595e+02]]
</pre></div></div>
</div>
</section>
<section id="Heterodyned-Likelihoods">
<h2>Heterodyned Likelihoods<a class="headerlink" href="#Heterodyned-Likelihoods" title="Link to this heading"></a></h2>
<p>Heterodyned Likelihoods are also available. See <a class="reference external" href="https://arxiv.org/abs/2109.02728">arXiv:2109.02728</a> for details on Heterodyning in general. We specifically implement the method used in <a class="reference external" href="https://arxiv.org/abs/1806.08792">arXiv:1806.08792</a>. The practical reason for using a Heterodyned Likelihood method is the computation can be performed along a sparse array of frequencies, rather than a dense array comming from a Fourier transform.</p>
<p>It is reasonably accurate with higher modes and produces the same posteriors as the full Likelihood. It uses a direct sum of modes prior to residual computation. It gets more accurate as modes are removed.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reference_index</span> <span class="o">=</span> <span class="n">ll</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>

<span class="n">reference_params</span> <span class="o">=</span> <span class="n">params_in</span><span class="p">[</span><span class="n">reference_index</span><span class="p">]</span>

<span class="c1"># how many frequencies to use</span>
<span class="n">length_f_het</span> <span class="o">=</span> <span class="mi">128</span>

<span class="c1"># initialize Likelihood</span>
<span class="n">like_het</span> <span class="o">=</span> <span class="n">HeterodynedLikelihood</span><span class="p">(</span>
    <span class="n">wave_gen</span><span class="p">,</span>
    <span class="n">data_freqs</span><span class="p">,</span>
    <span class="n">data_channels</span><span class="p">,</span>
    <span class="n">reference_params</span><span class="p">,</span>
    <span class="n">length_f_het</span><span class="p">,</span>
    <span class="n">use_gpu</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>


<span class="c1"># get_ll and not __call__ to work with lisatools</span>
<span class="n">ll_het</span> <span class="o">=</span> <span class="n">like_het</span><span class="o">.</span><span class="n">get_ll</span><span class="p">(</span><span class="n">params_in</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="o">**</span><span class="n">waveform_kwargs</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ll</span><span class="p">,</span> <span class="n">ll_het</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[[ -1.07304677  -1.00832284]
 [ -9.67441448  -8.90280807]
 [ -0.82049942  -0.74911253]
 [ -6.35227414  -5.85909352]
 [-10.27292833  -9.45085245]
 [ -0.18575894  -0.18590962]
 [ -0.35926129  -0.32960139]
 [ -2.60369419  -2.41820795]
 [ -1.14904283  -1.04894937]
 [ -5.69420711  -5.25570331]]
</pre></div></div>
</div>
</section>
</section>
<section id="Utility-functions">
<h1>Utility functions<a class="headerlink" href="#Utility-functions" title="Link to this heading"></a></h1>
<p>There are some utility functions in <code class="docutils literal notranslate"><span class="pre">bbhx</span></code> than can be very useful.</p>
<section id="Transformation-functions">
<h2>Transformation functions<a class="headerlink" href="#Transformation-functions" title="Link to this heading"></a></h2>
<p>When sampling on MBHBs, it can be useful to sample in the LISA constellation reference frame where the posterior modes in the sky have a generally predictable structure. In the LISA constellation referenence frame, the sky localization for a source generally has 8 sky modes: 4 longitudinal and 2 latitudinal. Longitudinal modes involve <span class="math notranslate nohighlight">\(\lambda + (0, 1, 2, 3)\times\pi/2\)</span> and <span class="math notranslate nohighlight">\(\psi + (0, 1, 2, 3)\times\pi/2\)</span>, where <span class="math notranslate nohighlight">\(\lambda\)</span> is the ecliptic longitude and <span class="math notranslate nohighlight">\(\psi\)</span> is the
polarization angle. The latitudinal modes are at <span class="math notranslate nohighlight">\((\pm\beta, \pm\cos{\iota}, \pm\cos{\psi})\)</span> where <span class="math notranslate nohighlight">\(\beta\)</span> and <span class="math notranslate nohighlight">\(\iota\)</span> are the ecliptic latitude and inclination, respectively.</p>
<section id="Transformations-to-and-from-LISA-and-SSB-reference-frames">
<h3>Transformations to and from LISA and SSB reference frames<a class="headerlink" href="#Transformations-to-and-from-LISA-and-SSB-reference-frames" title="Link to this heading"></a></h3>
<p>First, we will examine transformations of coordinates to and from the LISA and SSB reference frames. All of these functions can take arrays as input as well.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># start in the LISA frame</span>
<span class="n">tL</span> <span class="o">=</span> <span class="n">YRSID_SI</span>  <span class="c1"># time</span>
<span class="n">lambdaL</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">betaL</span> <span class="o">=</span> <span class="mf">0.8</span>
<span class="n">psiL</span> <span class="o">=</span> <span class="mf">0.3</span>

<span class="n">tSSB</span><span class="p">,</span> <span class="n">lambdaSSB</span><span class="p">,</span> <span class="n">betaSSB</span><span class="p">,</span> <span class="n">psiSSB</span> <span class="o">=</span> <span class="n">LISA_to_SSB</span><span class="p">(</span><span class="n">tL</span><span class="p">,</span> <span class="n">lambdaL</span><span class="p">,</span> <span class="n">betaL</span><span class="p">,</span> <span class="n">psiL</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tSSB</span><span class="p">,</span> <span class="n">lambdaSSB</span><span class="p">,</span> <span class="n">betaSSB</span><span class="p">,</span> <span class="n">psiSSB</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
31557992.305078838 2.3277015675208466 1.0933520437673625 2.3134690745168953
</pre></div></div>
</div>
<p>From SSB to LISA:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tL</span><span class="p">,</span> <span class="n">lambdaL</span><span class="p">,</span> <span class="n">betaL</span><span class="p">,</span> <span class="n">psiL</span> <span class="o">=</span> <span class="n">SSB_to_LISA</span><span class="p">(</span><span class="n">tSSB</span><span class="p">,</span> <span class="n">lambdaSSB</span><span class="p">,</span> <span class="n">betaSSB</span><span class="p">,</span> <span class="n">psiSSB</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tL</span><span class="p">,</span> <span class="n">lambdaL</span><span class="p">,</span> <span class="n">betaL</span><span class="p">,</span> <span class="n">psiL</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
31558149.7635457 0.4999999999999887 0.8000000000000038 0.29999999999999005
</pre></div></div>
</div>
</section>
<section id="Posterior-sky-mode-transformation">
<h3>Posterior sky-mode transformation<a class="headerlink" href="#Posterior-sky-mode-transformation" title="Link to this heading"></a></h3>
<p>You can transform your sky mode parameters to all longitudinal modes. If <code class="docutils literal notranslate"><span class="pre">inplace==False</span></code>, the first dimension will be 4 times as long as the input array.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">inc</span> <span class="o">=</span> <span class="mf">0.4</span>
<span class="n">lam</span> <span class="o">=</span> <span class="mf">3.42</span>
<span class="n">beta</span> <span class="o">=</span> <span class="mf">0.6</span>
<span class="n">psi</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">inc</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">psi</span><span class="p">])</span>

<span class="c1"># if we had the whole mbh parameter array like used in BBHWaveformFD,</span>
<span class="c1"># it would be dict(inc=7, lam=8, beta=9, psi=10) included f_ref as a parameter</span>
<span class="n">ind_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">inc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lam</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">psi</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;start params: </span><span class="si">{</span><span class="n">coords</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">out_coords</span> <span class="o">=</span> <span class="n">mbh_sky_mode_transform</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">ind_map</span><span class="o">=</span><span class="n">ind_map</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;long&quot;</span><span class="p">,</span> <span class="n">cos_i</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;end params: </span><span class="si">{</span><span class="n">out_coords</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
start params: [0.4  3.42 0.6  1.  ]
end params: [[0.4        3.42       0.6        1.        ]
 [0.4        4.99079633 0.6        2.57079633]
 [0.4        0.27840735 0.6        1.        ]
 [0.4        1.84920367 0.6        2.57079633]]
</pre></div></div>
</div>
<p>Or latitudinal transforms. If <code class="docutils literal notranslate"><span class="pre">inplace==False</span></code>, the first dimension will be 2 times as long as the input array.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;start params: </span><span class="si">{</span><span class="n">coords</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">out_coords</span> <span class="o">=</span> <span class="n">mbh_sky_mode_transform</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">ind_map</span><span class="o">=</span><span class="n">ind_map</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="n">cos_i</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;end params: </span><span class="si">{</span><span class="n">out_coords</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
start params: [0.4  3.42 0.6  1.  ]
end params: [[ 0.4         3.42        0.6         1.        ]
 [ 2.74159265  3.42       -0.6         2.14159265]]
</pre></div></div>
</div>
<p>Or both transforms. If <code class="docutils literal notranslate"><span class="pre">inplace==False</span></code>, the first dimension will be 8 times as long as the input array.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;start params: </span><span class="si">{</span><span class="n">coords</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">out_coords</span> <span class="o">=</span> <span class="n">mbh_sky_mode_transform</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">ind_map</span><span class="o">=</span><span class="n">ind_map</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">cos_i</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;end params: </span><span class="si">{</span><span class="n">out_coords</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
start params: [0.4  3.42 0.6  1.  ]
end params: [[ 0.4         3.42        0.6         1.        ]
 [ 2.74159265  3.42       -0.6         2.14159265]
 [ 0.4         4.99079633  0.6         2.57079633]
 [ 2.74159265  4.99079633 -0.6         0.57079633]
 [ 0.4         0.27840735  0.6         1.        ]
 [ 2.74159265  0.27840735 -0.6         2.14159265]
 [ 0.4         1.84920367  0.6         2.57079633]
 [ 2.74159265  1.84920367 -0.6         0.57079633]]
</pre></div></div>
</div>
<p>You can also do these transformations in-place. When you do this, the input binaries will be assigned to new sky modes based on the transformation. Every 2, 4, or 8 binaries will be given the same sky mode transformation if latitudinal, longitudinal, or both transformations are applied, respectively.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">in_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">inc</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">psi</span><span class="p">]),</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;start params: </span><span class="si">{</span><span class="n">in_coords</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">out_coords</span> <span class="o">=</span> <span class="n">mbh_sky_mode_transform</span><span class="p">(</span><span class="n">in_coords</span><span class="p">,</span> <span class="n">ind_map</span><span class="o">=</span><span class="n">ind_map</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">cos_i</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;end params: </span><span class="si">{</span><span class="n">out_coords</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
start params: [[0.4  3.42 0.6  1.  ]
 [0.4  3.42 0.6  1.  ]
 [0.4  3.42 0.6  1.  ]
 [0.4  3.42 0.6  1.  ]
 [0.4  3.42 0.6  1.  ]
 [0.4  3.42 0.6  1.  ]
 [0.4  3.42 0.6  1.  ]
 [0.4  3.42 0.6  1.  ]
 [0.4  3.42 0.6  1.  ]
 [0.4  3.42 0.6  1.  ]
 [0.4  3.42 0.6  1.  ]
 [0.4  3.42 0.6  1.  ]
 [0.4  3.42 0.6  1.  ]
 [0.4  3.42 0.6  1.  ]
 [0.4  3.42 0.6  1.  ]
 [0.4  3.42 0.6  1.  ]]
end params: [[ 0.4         3.42        0.6         1.        ]
 [ 2.74159265  3.42       -0.6         2.14159265]
 [ 0.4         4.99079633  0.6         2.57079633]
 [ 2.74159265  4.99079633 -0.6         0.57079633]
 [ 0.4         0.27840735  0.6         1.        ]
 [ 2.74159265  0.27840735 -0.6         2.14159265]
 [ 0.4         1.84920367  0.6         2.57079633]
 [ 2.74159265  1.84920367 -0.6         0.57079633]
 [ 0.4         3.42        0.6         1.        ]
 [ 2.74159265  3.42       -0.6         2.14159265]
 [ 0.4         4.99079633  0.6         2.57079633]
 [ 2.74159265  4.99079633 -0.6         0.57079633]
 [ 0.4         0.27840735  0.6         1.        ]
 [ 2.74159265  0.27840735 -0.6         2.14159265]
 [ 0.4         1.84920367  0.6         2.57079633]
 [ 2.74159265  1.84920367 -0.6         0.57079633]]
</pre></div></div>
</div>
</section>
</section>
</section>
<section id="Citations">
<h1>Citations<a class="headerlink" href="#Citations" title="Link to this heading"></a></h1>
<p>You can access citations for each class with the <code class="docutils literal notranslate"><span class="pre">citation</span></code> property.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">wave_gen</span><span class="o">.</span><span class="n">citation</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

@article{Katz:2020hku,
    author = &#34;Katz, Michael L. and Marsat, Sylvain and Chua, Alvin J. K. and Babak, Stanislav and Larson, Shane L.&#34;,
    title = &#34;{GPU-accelerated massive black hole binary parameter estimation with LISA}&#34;,
    eprint = &#34;2005.01827&#34;,
    archivePrefix = &#34;arXiv&#34;,
    primaryClass = &#34;gr-qc&#34;,
    doi = &#34;10.1103/PhysRevD.102.023033&#34;,
    journal = &#34;Phys. Rev. D&#34;,
    volume = &#34;102&#34;,
    number = &#34;2&#34;,
    pages = &#34;023033&#34;,
    year = &#34;2020&#34;
}

@article{Katz:2021uax,
    author = &#34;Katz, Michael L.&#34;,
    title = &#34;{A fully-automated end-to-end pipeline for massive black hole binary signal extraction from LISA data}&#34;,
    eprint = &#34;2111.01064&#34;,
    archivePrefix = &#34;arXiv&#34;,
    primaryClass = &#34;gr-qc&#34;,
    month = &#34;11&#34;,
    year = &#34;2021&#34;
}

@article{michael katz_2021,
    title={mikekatz04/BBHx: First official public release},
    DOI={10.5281/zenodo.5730688},
    abstractNote={No description provided.},
    publisher={Zenodo},
    author={Michael Katz},
    year={2021},
    month={Nov}
}

@article{Marsat:2018oam,
    author = &#34;Marsat, Sylvain and Baker, John G.&#34;,
    title = &#34;{Fourier-domain modulations and delays of gravitational-wave signals}&#34;,
    eprint = &#34;1806.10734&#34;,
    archivePrefix = &#34;arXiv&#34;,
    primaryClass = &#34;gr-qc&#34;,
    month = &#34;6&#34;,
    year = &#34;2018&#34;
}

@article{Marsat:2020rtl,
    author = &#34;Marsat, Sylvain and Baker, John G. and Dal Canton, Tito&#34;,
    title = &#34;{Exploring the Bayesian parameter estimation of binary black holes with LISA}&#34;,
    eprint = &#34;2003.00357&#34;,
    archivePrefix = &#34;arXiv&#34;,
    primaryClass = &#34;gr-qc&#34;,
    doi = &#34;10.1103/PhysRevD.103.083011&#34;,
    journal = &#34;Phys. Rev. D&#34;,
    volume = &#34;103&#34;,
    number = &#34;8&#34;,
    pages = &#34;083011&#34;,
    year = &#34;2021&#34;
}

@article{London2018,
    archivePrefix = {arXiv},
    arxivId = {gr-qc/1708.00404},
    author = {London, Lionel and Khan, Sebastian and Fauchon-Jones, Edward and Garc&#39;ia, Cecilio and Hannam, Mark and Husa, Sascha and Jim{&#39;{e}}nez-Forteza, Xisco and Kalaghatgi, Chinmay and Ohme, Frank and Pannarale, Francesco},
    doi = {10.1103/PhysRevLett.120.161102},
    eprint = {1708.00404},
    journal = {\prl},
    keywords = {General Relativity and Quantum Cosmology},
    month = {apr},
    number = {16},
    pages = {161102},
    primaryClass = {gr-qc},
    title = {{First Higher-Multipole Model of Gravitational Waves from Spinning and Coalescing Black-Hole Binaries}},
    volume = {120},
    year = {2018}
}

@article{Husa2016,
    archivePrefix = {arXiv},
    arxivId = {gr-qc/1508.07250},
    author = {Husa, S and Khan, S and Hannam, M and P{&#34;{u}}rrer, M and Ohme, F and Forteza, X.$\sim$J. and Boh{&#39;{e}}, A},
    doi = {10.1103/PhysRevD.93.044006},
    eprint = {1508.07250},
    journal = {\prd},
    month = {feb},
    number = {4},
    pages = {44006},
    primaryClass = {gr-qc},
    title = {{Frequency-domain gravitational waves from nonprecessing black-hole binaries. I. New numerical waveforms and anatomy of the signal}},
    volume = {93},
    year = {2016}
}


@article{Khan2016,
    archivePrefix = {arXiv},
    arxivId = {gr-qc/1508.07253},
    author = {Khan, S and Husa, S and Hannam, M and Ohme, F and P{&#34;{u}}rrer, M and Forteza, X.$\sim$J. and Boh{&#39;{e}}, A},
    doi = {10.1103/PhysRevD.93.044007},
    eprint = {1508.07253},
    journal = {\prd},
    month = {feb},
    number = {4},
    pages = {44007},
    primaryClass = {gr-qc},
    title = {{Frequency-domain gravitational waves from nonprecessing black-hole binaries. II. A phenomenological model for the advanced detector era}},
    volume = {93},
    year = {2016}
}

</pre></div></div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="user/utils.html" class="btn btn-neutral float-left" title="Utility Functions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Michael L. Katz.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>